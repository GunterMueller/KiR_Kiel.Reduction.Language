/* This file is automatically generated (by scr2c.awk)
** DO NOT EDIT BELOW!
*/

#include <dbug.h>

#include <msMacros.h>
#include <scriptMacros.h>
#include <groups.h>
#include <externVars.h>

extern void SET_MODE();
extern void SET_X_LABEL();
extern void SET_Y_LABEL();
extern void SET_X_GRID();
extern void SET_Y_GRID();
extern void SET_X_MIN();
extern void SET_X_MAX();
extern void SET_Y_MIN();
extern void SET_Y_MAX();
extern void SET_LEGEND();
extern void SET_STYLE();
extern void SET_LINESTYLE();
extern void SET_MARKER();
extern void SET_SHADE();
extern void CREATE_BAR();
extern void INCREMENT();
extern void REMOVE_XY();
extern void ADD_XY();
extern void UPDATE_XY();
extern void CREATION_ARROW();
extern void FILL_SLOT();
extern void SHOW_HISTORY();
extern void SHOW_FUTURE();
extern void SET_METER();
extern void DRAW_METER();
extern void SET_DIMENSIONS();
extern void FILL_ALL();
extern void FILL_BLOCK();
extern int GET_HEAPBASE();
extern void DRAW_FRAGMENTATION();
extern void SET_CACHING();
extern void SET_STACKING();
extern void SET_SEPARATION();
extern void SET_FRAGMENTATION();
extern void ADD_NODE();
extern void REMOVE_NODE();
extern void SET_NODES();
extern void SET_LABELS();
extern void SET_DEPTH();
extern void ZOOM_IN();
extern void ZOOM_OUT();
extern void SHOW_TOP();
extern void NEXT_FRAME();
extern void NEXT_FRAME_BUT_CONTINUE();
extern void SET_DELAY();
extern void SET_RATE();
extern void SET_TITLE();
extern void SET_STYLE();
extern void SET_COLORS();
extern void GET_TIME();
extern void HEADER_FILE();
extern void HEADER_TIME();
extern void HEADER_NODISTNUM();
extern void HEADER_DIMENSION();
extern void HEADER_STEPS();
extern void HEADER_FACTOR();
extern void HEADER_BINARY();
extern void HEADER_HEAPSIZE();
extern void HEADER_HEAPDES();
extern void FLUSH();

extern void SAVE();
extern void PRINT();
extern void CLEAR();

static double size, timeFactor, previousTime;
static char rememberFile[100], rememberTime[100], rememberSteps[100],
	    rememberFactor[100], rememberDimension[100], temp[1000];
static int pids[MAX_PROCESSORS][MAX_PROCESSES],
           numProcesses[MAX_PROCESSORS];
static int numProcessors;
static int nextBar[MAX_PROCESSORS][MAX_PROCESSES],
           frameSize[MAX_PROCESSORS][MAX_PROCESSES],
           i, j;
int pid(processor, realPid)
int processor, realPid;
{
	int i;
	for(i=0; i<numProcesses[processor]; ++i) {
		if(pids[processor][i] == realPid) {
			return(i);
		}
	}
	return(-1);
}
int numBits(mask)
int mask;
{
	int i=0;
	while(mask) {
		i += (mask & 1);
		mask >>= 1;
	}
	return(i);
}




void eval()
{
  /*DBUG_ENTER("eval");*/

  switch(ID) {

  case MINDEX_BEGIN:
SET_MODE(BAR_CHART);
HEADER_FILE(rememberFile);
HEADER_TIME(rememberTime);
HEADER_STEPS(rememberSteps);
HEADER_FACTOR(rememberFactor);
sprintf(temp, "DISTs + DISTBs -- %s -- %s reduction steps",
	rememberFile, rememberSteps);
SET_TITLE(temp);
timeFactor = atof(rememberFactor);
HEADER_DIMENSION(rememberDimension);
numProcessors = (1 << atoi(rememberDimension));
SET_NAME("DISTs+DISTBs");
SET_X_LABEL("DISTs (optimized)                                                       DISTs (real)                                                        DISTBs (optimized)                                                       DISTBs (real)");
SET_Y_LABEL("# of transmitted elements");
SET_X_GRID(OFF);
SET_Y_GRID(OFF);
CREATE_BAR("DISTs_optimized", 1, NULL);
CREATE_BAR("Dummy_1", 2, NULL);
CREATE_BAR("DISTs_real", 3, NULL);
CREATE_BAR("Dummy_2", 4, NULL);
CREATE_BAR("DISTBs_optimized", 5, NULL);
CREATE_BAR("Dummy_3", 6, NULL);
CREATE_BAR("DISTBs_real", 7, NULL);
NEXT_FRAME();
for(i=0; i<numProcessors; ++i) {
	for(j=0; j<numProcessors; ++j) {
		pids[i][j] = -1;			
	}
	numProcesses[i] = 0;
}
break;

  case MINDEX_COUNT_DIST:
/* Is this pid in the table yet? */
if(pid(PROCESSOR, PROCESS) == -1) {
	pids[PROCESSOR][numProcesses[PROCESSOR]++] = PROCESS;
}
nextBar[PROCESSOR][pid(PROCESSOR, PROCESS)] = 0;
break;

  case MINDEX_COUNT_DISTB:
/* Is this pid in the table yet? */
if(pid(PROCESSOR, PROCESS) == -1) {
	pids[PROCESSOR][numProcesses[PROCESSOR]++] = PROCESS;
}
nextBar[PROCESSOR][pid(PROCESSOR, PROCESS)] = 1;
break;

  case MINDEX_PROC_DISTSTACKS:
/* Is this pid in the table yet? */
if(pid(PROCESSOR, PROCESS) == -1) {
	pids[PROCESSOR][numProcesses[PROCESSOR]++] = PROCESS;
}
frameSize[PROCESSOR][pid(PROCESSOR, PROCESS)] = PDS_SIZE;

  case MINDEX_PROC_DIST:
if(nextBar[PROCESSOR, pid(PROCESSOR, PROCESS)]) {
	/* DISTB */
	INCREMENT(5, (double)numBits(PD_SIZE));
	INCREMENT(7, (double)frameSize[PROCESSOR]
	                              [pid(PROCESSOR, PROCESS)]);
} else {
	/* DIST */
	INCREMENT(1, (double)PD_SIZE);
	INCREMENT(3, (double)PD_SIZE);
}
break;

  case MINDEX_END:
NEXT_FRAME();
break;
  }

  /*DBUG_VOID_RETURN*/

  return;
}


void iNeed(needed)
char needed[IDS_LEN][MAX_IDS]; {
  int i = 0;

  strcpy(needed[i++], "COUNT_DIST");
  strcpy(needed[i++], "COUNT_DISTB");
  strcpy(needed[i++], "PROC_DISTSTACKS");
  strcpy(needed[i++], "PROC_DIST");
  strcpy(needed[i++], "");

  return;
}
